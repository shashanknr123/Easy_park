-- DBMS FINAL EVALUATION
-- By Chavva Bala Meghanath Reddy, Chinmayananda, Danussh, Harsh R Shah
DROP DATABASE IF EXISTS `VehicleParkingManagementSystem`; # Deletes if there is any existing database with the same name. 
CREATE DATABASE `VehicleParkingManagementSystem`;
USE `VehicleParkingManagementSystem`;  # Use the database.

-- Vehicle Details Table
CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`VehicleDetails` (
  `VehicleNumber` VARCHAR(10) NOT NULL,
  `Type` VARCHAR(4) NOT NULL,
  `Company` VARCHAR(45) NOT NULL,
  `Model` VARCHAR(45) NOT NULL,
  `Colour` VARCHAR(45) NOT NULL,
  `FuelType` VARCHAR(45) NOT NULL,
  `EngineNumber` VARCHAR(45) NOT NULL,
  `ChassisNumber` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`VehicleNumber`))
  ENGINE = InnoDB;
  
-- Owner's Details Table
  CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`OwnerDetails` (
  `IDNumber` VARCHAR(45) NOT NULL,
  `IDProof` VARCHAR(45) NOT NULL,
  `Name` VARCHAR(45) NOT NULL,
  `MobileNumber` VARCHAR(45) NULL,
  `Address` VARCHAR(45) NULL,
  PRIMARY KEY (`IDNumber`))
  ENGINE = InnoDB;
  
-- Vehicle Ownership
  CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`VehicleOwnership` (
  `VehicleNumber` VARCHAR(10) NOT NULL,
  `IDNumber` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`VehicleNumber`, `IDNumber`),
  CONSTRAINT `VehicleNumber`
    FOREIGN KEY (`VehicleNumber`)
    REFERENCES `VehicleParkingManagementSystem`.`VehicleDetails` (`VehicleNumber`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT `IDNumber`
    FOREIGN KEY (`IDNumber`)
    REFERENCES `VehicleParkingManagementSystem`.`OwnerDetails` (`IDNumber`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
    ENGINE = InnoDB;
 
-- Driver's Detail Table
  CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`DriverDetails` (
  `DLNumber` VARCHAR(15) NOT NULL,
  `Name` VARCHAR(45) NULL,
  `MobileNumber` VARCHAR(45) NULL,
  PRIMARY KEY (`DLNumber`))
  ENGINE = InnoDB;
  
  
-- Charge Table
  CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`Charge` (
  `Type` VARCHAR(45) NOT NULL,
  `Charge` FLOAT NULL,
  PRIMARY KEY (`Type`))
  ENGINE = InnoDB;
  
-- Slot Table
CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`Slot` (
  `Slot` INT NOT NULL,
  `Type` VARCHAR(45) NULL,
  `Occupancy` CHAR(1) NULL,
  PRIMARY KEY (`Slot`),
  CONSTRAINT `Type`
    FOREIGN KEY (`Type`)
    REFERENCES `VehicleParkingManagementSystem`.`Charge` (`Type`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
    ENGINE = InnoDB;
 
-- Slot Allotment Table
CREATE TABLE IF NOT EXISTS `VehicleParkingManagementSystem`.`SlotAllotment` (
  `VehicleNumber` VARCHAR(10) NOT NULL,
  `InTime` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `OutTime` DATETIME ,
  `State` BOOLEAN DEFAULT true,
  `Charge` FLOAT NULL,
  `Slot` INT NOT NULL,
  `DLNumber` VARCHAR(15) NOT NULL,
  `Tow` BOOLEAN DEFAULT FALSE,
  PRIMARY KEY (`InTime`, `VehicleNumber`),
  CONSTRAINT `Slot`
    FOREIGN KEY (`Slot`)
    REFERENCES `VehicleParkingManagementSystem`.`Slot` (`Slot`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_VehicleNumber`
    FOREIGN KEY (`VehicleNumber`)
    REFERENCES `VehicleParkingManagementSystem`.`VehicleDetails` (`VehicleNumber`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT `DLNumber`
    FOREIGN KEY (`DLNumber`)
    REFERENCES `VehicleParkingManagementSystem`.`DriverDetails` (`DLNumber`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
    ENGINE = InnoDB;
    

-- Defining Charge
INSERT INTO `Charge` VALUES
	('CAR', 0.05),
    ('BIKE', 0.025);
-- SELECT *  FROM `Charge`;

-- Creating Slot spaces
INSERT INTO `Slot` VALUES
	(1, 'CAR', 'N'),
    (2, 'CAR', 'N'),
	(3, 'CAR', 'N'),
    (4, 'CAR', 'N'),
    (5, 'CAR', 'N'),
    (6, 'CAR', 'N'),
    (7, 'CAR', 'N'),
    (8, 'CAR', 'N'),
    (9, 'CAR', 'N'),
    (10, 'CAR', 'N'),
    (11, 'CAR', 'N'),
    (12, 'CAR', 'N'),
    (13, 'CAR', 'N'),
    (14, 'CAR', 'N'),
    (15, 'CAR', 'N'),
    (16, 'BIKE', 'N'),
    (17, 'BIKE', 'N'),
    (18, 'BIKE', 'N'),
    (19, 'BIKE', 'N'),
    (20, 'BIKE', 'N'),
    (21, 'BIKE', 'N'),
    (22, 'BIKE', 'N'),
    (23, 'BIKE', 'N'),
    (24, 'BIKE', 'N'),
    (25, 'BIKE', 'N'),
    (26, 'BIKE', 'N'),
    (27, 'BIKE', 'N'),
    (28, 'BIKE', 'N'),
    (29, 'BIKE', 'N'),
    (30, 'BIKE', 'N');
-- SELECT *  FROM `Slot`;

-- Registering Vehicle and Owner's Details
INSERT INTO `VehicleDetails` VALUES
	('TN09GU5456', 'BIKE', 'ROYAL ENFIELD', 'CLASSIC', 'GUNMETAL GREY', 'PETROL', 'UTD65160028', 'JF1GF4851YH807036'),
	('TN09DG4165', 'BIKE', 'ROYAL ENFIELD', 'THUNDERBIRD', 'ORANGE', 'PETROL', 'YMR35096454', 'WDBUF70J03A120248'),
	('TN10IU4576', 'BIKE', 'ROYAL ENFIELD', 'HIMALAYAN', 'BLACK', 'PETROL', 'AAP06725788', '1FTRX17W33NB02032'),
	('AP20CF2356', 'BIKE', 'HONDA', 'ACTIVA', 'WHITE', 'PETROL', 'DJK91684043', '1FDKF37G8VEB21294'),
	('AP30XO2286', 'BIKE', 'HONDA', 'SHINE', 'BLACK', 'PETROL', 'DHQ28908380', '1FT7W2B68FEA89564'),
	('AP06UJ8051', 'BIKE', 'HONDA', 'DIO', 'RED', 'PETROL', 'JGY65632631', '1Y1SK54881Z429153'),
	('AP80OJ2504', 'BIKE', 'HONDA', 'UNICORN', 'BLACK', 'PETROL', 'VVO22940368', '5TDJK3DC7DS068657'),
	('KA29OV4333', 'BIKE', 'HONDA', 'HORNET', 'BLUE', 'PETROL', 'MEB05822038', '19UUA56663A067919'),
	('KA14VQ3431', 'BIKE', 'HONDA', 'HNESS', 'BLUE', 'PETROL', 'SZZ20503208', '1FA6P0G73E5374157'),
	('KA32DN5008', 'BIKE', 'HONDA', 'GRAZIA', 'BLACK', 'PETROL', 'BHT30014068', '1GNCS13W1W2130550'),
	('KA59QP1589', 'BIKE', 'TVS', 'JUPITER', 'BROWN', 'PETROL', 'UAU16446836', '2T2ZK1BAXDC112616'),
	('KA01SH5904', 'BIKE', 'TVS', 'NTORQ', 'RED', 'PETROL', 'HJB43748242', '2HKRL18032H508512'),
	('KA19VO0900', 'BIKE', 'TVS', 'APACHE', 'RED', 'PETROL', 'WKO31330644', '1FTEW1C8XAFD66073'),
	('KA26AF6966', 'BIKE', 'TVS', 'SPORT', 'WHITE', 'PETROL', 'OAX40682789', '5GAER23758J218863'),
	('KA12UL1052', 'BIKE', 'TVS', 'RADEON', 'BLACK', 'PETROL', 'EXB32122688', 'WMWMM33558TP71012'),
	('KA09ZD9681', 'BIKE', 'TVS', 'STAR CITY', 'BLACK', 'PETROL', 'ZGO37023712', '5TETX22N08Z518831'),
	('KA02PJ1829', 'BIKE', 'BAJAJ', 'PULSAR', 'WHITE', 'PETROL', 'UPQ98452743', '1FMDU32X9VZB47241'),
	('KA01JD0794', 'BIKE', 'BAJAJ', 'PLATINA', 'GREEN', 'PETROL', 'LDA85251281', '1FAFP34N87W315607'),
	('KA05FS0598', 'BIKE', 'BAJAJ', 'DOMINOR', 'GREEN', 'PETROL', 'ZHN41794649', '3C7WRTBL3DG527432'),
	('KA16BN8516', 'BIKE', 'BAJAJ', 'AVENGER', 'WHITE', 'PETROL', 'WUH16547657', '1D4GP24R16B596511'),
	('KA17OZ5090', 'BIKE', 'BAJAJ', 'CHETAK', 'RED', 'PETROL', 'RGO09000845', '2X1TADR9X7RM63355'),
	('KA22PG5543', 'BIKE', 'SUZUKI', 'HAYABUSA', 'BLACK', 'PETROL', 'BNK35106864', '1FMRU17L01LA88223'),
	('KA26AC9953', 'BIKE', 'SUZUKI', 'ACCESS', 'BROWN', 'PETROL', 'GEX93493782', '5NMSH73E77H031936'),
	('KA24IW3812', 'BIKE', 'SUZUKI', 'GIXXER', 'BLACK', 'PETROL', 'MXQ15793191', 'SCBDR33W58C053525'),
	('KA03OS8915', 'BIKE', 'SUZUKI', 'BURGMAN', 'WHITE', 'PETROL', 'KHV88775661', '4A4AR4AU7FE014582'),
	('KA03OB4686', 'BIKE', 'SUZUKI', 'INTRUDER', 'BLACK', 'PETROL', 'UMI39239615', '2G1WG5E30D1264554'),
	('TN08TV8642', 'CAR', 'HONDA', 'AMAZE', 'RED', 'DIESEL', 'DKP56147763', '3GCPKTE38BG370365'),
	('TN24VH4589', 'CAR', 'HONDA', 'WR-V', 'GREY', 'PETROL', 'SHK16540372', 'JM3KE2DEXD0129114'),
	('TN16QA6205', 'CAR', 'HONDA', 'CITY', 'YELLOW', 'DIESEL', 'SRK80724776', '1G1JC6SH5C4154470'),
	('TN17WL0579', 'CAR', 'HONDA', 'HR-V', 'WHITE', 'DIESEL', 'FLO66827795', '4T1BF1FK8EU343835'),
	('TN18UW0259', 'CAR', 'HYUNDAI', 'CRETA', 'BLACK', 'DIESEL', 'BJL05819495', 'JM1BL1SF8A1279376'),
	('TN13TJ3407', 'CAR', 'HYUNDAI', 'VENUE', 'WHITE', 'DIESEL', 'VWE40317580', '3VWLZ7AJ4BM309468'),
	('TN23KI7954', 'CAR', 'HYUNDAI', 'I20', 'BROWN', 'DIESEL', 'SST09718317', 'SALTY1245YA265720'),
	('TN24IF1089', 'CAR', 'HYUNDAI', 'I10 NIOS', 'YELLOW', 'PETROL', 'TYZ55396019', 'JTKJF5C73F3090382'),
	('TN04YO3554', 'CAR', 'HYUNDAI', 'VERNA', 'VIOLET', 'DIESEL', 'WSS55341231', '2FMEK63C89BA58115'),
	('TN16ZX3533', 'CAR', 'HYUNDAI', 'AURA', 'RED', 'DIESEL', 'BLL50948698', '1C4HJWFG4DL584446'),
	('TN02GJ8084', 'CAR', 'HYUNDAI', 'SANTRO', 'GREEN', 'DIESEL', 'HRT39520019', '2T2BK1BA5FC260340'),
	('TN05SL2861', 'CAR', 'HYUNDAI', 'ELENTRA', 'CIAN', 'DIESEL', 'HXP08945854', '5LMJJ3J59EEL00247'),
	('TN09DJ1847', 'CAR', 'TATA', 'NEXON', 'BLUE', 'DIESEL', 'UCI20309198', '1ZVFT82H075319573'),
	('KL05JW1823', 'CAR', 'TATA', 'ALTROZ', 'BLACK', 'DIESEL', 'GLH89902084', '5GAKVBED6BJ145365'),
	('KL13GC1750', 'CAR', 'TATA', 'TIAGO', 'GREEN', 'DIESEL', 'XVP33169932', '2T1BURHE6FC311741'),
	('KL04NW8748', 'CAR', 'TATA', 'SAFARI', 'BLACK', 'DIESEL', 'UHZ84783012', '5XXGR4A68DG181125'),
	('KL02WT2513', 'CAR', 'TATA', 'HARRIER', 'WHITE', 'DIESEL', 'COE05573254', '2C4GP54L04R564125'),
	('KL06NW7263', 'CAR', 'TATA', 'TIGOR', 'GREEN', 'PETROL', 'GOJ24933468', '1XP7DB9X24D817319'),
	('KL09BF8806', 'CAR', 'SKODA', 'RAPID', 'VIOLET', 'DIESEL', 'KQD32434200', '1FTPX12546KA91750'),
	('KL04VZ2216', 'CAR', 'SKODA', 'SUPERB', 'INDIGO', 'DIESEL', 'AKT40233424', 'JTHBK1EGXB2465728'),
	('KL03IR5998', 'CAR', 'SKODA', 'OCTAVIA', 'BLUE', 'DIESEL', 'JZA87260780', '5J8TB4H56FL013939'),
	('KL06LZ1741', 'CAR', 'SKODA', 'KODIAQ', 'GREEN', 'DIESEL', 'YKH72230957', '2B3LJ54T29H542741'),
	('KL09WX1877', 'CAR', 'FIAT', 'ABARTH', 'YELLOW', 'DIESEL', 'AAL73912896', '2LMDJ6JKXBBJ02408'),
	('KL03CX7308', 'CAR', 'FIAT', 'ADVENTURE', 'ORANGE', 'PETROL', 'VMH57272251', '4T3ZA3BB2EU086533'),
	('KL05NC4741', 'CAR', 'FIAT', 'AVVENTURE', 'RED', 'DIESEL', 'YTF15897654', 'WP0AD299X8S796293');
-- SELECT *  FROM `VehicleDetails`;


INSERT INTO `OwnerDetails` VALUES
	('811185401970', 'AADHAR', 'PRIYA', '9440492795', 'BHOGADI'),
	('738880492993', 'AADHAR', 'TANYA', '9018340082', 'KUVEMPU NAGARA'),
	('612087706645', 'AADHAR', 'PRIYANKA', '9740601013', 'BHOGADI'),
	('733758780157', 'AADHAR', 'ARUN', '9935159851', 'BHOGADI'),
	('827247740807', 'AADHAR', 'VIJAY', '6537635821', 'KUVEMPU NAGARA'),
	('879874898344', 'AADHAR', 'VANI', '6842519600', 'MANASA GANGOTRI'),
	('906486157074', 'AADHAR', 'ANJALI', '6638384132', 'BHOGADI'),
	('677295899753', 'AADHAR', 'SHREYA', '6707186023', 'BANNIMANTAP'),
	('759557669172', 'AADHAR', 'SNEHA', '6271908975', 'VIJAYA NAGARA'),
	('432817641732', 'AADHAR', 'VARSHA', '8764120617', 'MANASA GANGOTRI'),
	('868474661677', 'AADHAR', 'RAMYA', '8860743522', 'VIJAYA NAGARA'),
	('426504580553', 'AADHAR', 'ANANYA', '8790378549', 'MANASA GANGOTRI'),
	('R1611957', 'PASSPORT', 'ASHWINI', '8741732285', 'VIJAYA NAGARA'),
	('Y1962537', 'PASSPORT', 'VAISHNAVI', '8827009904', 'MANASA GANGOTRI'),
	('Q7784888', 'PASSPORT', 'MAYA', '9390034366', 'JANATHA NAGAR'),
	('J9595659', 'PASSPORT', 'TEJASHWI', '6907408438', 'BHOGADI'),
	('N3265059', 'PASSPORT', 'RAHUL', '8225777477', 'BANNIMANTAP'),
	('M8986427', 'PASSPORT', 'ABHISHEK', '8850863196', 'KUVEMPU NAGARA'),
	('W7949222', 'PASSPORT', 'MANOJ', '8327092918', 'JANATHA NAGAR'),
	('Y8310024', 'PASSPORT', 'RAJ', '9061172124', 'MANASA GANGOTRI'),
	('L1738269', 'PASSPORT', 'ARUN', '9270346158', 'JANATHA NAGAR'),
	('D4596717', 'PASSPORT', 'TARUN', '9201590956', 'KUVEMPU NAGARA'),
	('KA4437564037123', 'DL', 'KARAN', '9272551692', 'CHAMARAJAPURA'),
	('KA2302656106456', 'DL', 'ARYAN', '8658137551', 'CHAMARAJAPURA'),
	('KA5915915780789', 'DL', 'NITISH', '9757826908', 'MANASA GANGOTRI'),
	('KA9271215168123', 'DL', 'YAGNESH', '9175018249', 'CHAMARAJAPURA'),
	('KA0116153338456', 'DL', 'HARSH', '9018585459', 'BANNIMANTAP'),
	('KA7100176472789', 'DL', 'PRAJEETH', '8068041901', 'BHOGADI'),
	('KA1650322703123', 'DL', 'MEGHANATH', '8791914728', 'CHAMARAJAPURA'),
	('KA8559318708456', 'DL', 'BADRINATH', '9362113557', 'VIJAYA NAGARA'),
	('KA3490450786789', 'DL', 'MOUNIKA', '9362199734', 'KUVEMPU NAGARA'),
	('KA4900720050123', 'DL', 'JAYANTH', '9893525968', 'JANATHA NAGAR'),
	('KA5181015879456', 'DL', 'SAI NIVAS', '9737787196','VIJAYA NAGARA'), 
	('KA1635441300789', 'DL', 'VIJAY', '9239396632', 'BANNIMANTAP'),
	('KA9714832437123', 'DL', 'RAM', '9769508876', 'KUVEMPU NAGARA'),
	('KA1222009621456', 'DL', 'VIVEK', '8910757191', 'VIJAYA NAGARA'),
	('AP2380219472789', 'DL', 'ADITYA', '9835502411', 'MANASA GANGOTRI'),
	('AP5698741236123', 'DL', 'PRANAY', '9415531413', 'BANNIMANTAP'),
	('AP7568974526456', 'DL', 'THANMAI', '9091937206', 'KUVEMPU NAGARA'),
	('AP2569874123300', 'DL', 'NAMAN', '9185355193', 'BHOGADI');
-- SELECT *  FROM `OwnerDetails`;

INSERT INTO `VehicleOwnership` VALUES
	('TN09GU5456', '811185401970'),
	('TN09DG4165', 'R1611957'),
	('TN10IU4576', '738880492993'),
	('AP20CF2356', 'Q7784888'),
	('AP30XO2286', '612087706645'),
	('AP06UJ8051', 'KA0116153338456'),
	('AP80OJ2504', '733758780157'),
	('KA29OV4333', '827247740807'),
	('KA14VQ3431', '879874898344'),
	('KA32DN5008', '906486157074'),
	('KA59QP1589', '677295899753'),
	('KA01SH5904', '759557669172'),
	('KA19VO0900', 'KA7100176472789'),
	('KA26AF6966', '432817641732'),
	('KA12UL1052', '868474661677'),
	('KA09ZD9681', '426504580553'),
	('KA02PJ1829', 'R1611957'),
	('KA01JD0794', 'Y1962537'),
	('KA05FS0598', 'KA9271215168123'),
	('KA16BN8516', 'Q7784888'),
	('KA17OZ5090', 'KA0116153338456'),
	('KA22PG5543', 'J9595659'),
	('KA26AC9953', 'N3265059'),
	('KA24IW3812', 'KA1650322703123'),
	('KA03OS8915', 'M8986427'),
	('KA03OB4686', 'W7949222'),
	('TN08TV8642', 'KA0116153338456'),
	('TN24VH4589', 'Y8310024'),
	('TN16QA6205', 'KA1650322703123'),
	('TN17WL0579', 'L1738269'),
	('TN18UW0259', 'D4596717'),
	('TN13TJ3407', 'KA4437564037123'),
	('TN23KI7954', 'KA2302656106456'),
	('TN24IF1089', 'KA5915915780789'),
	('TN04YO3554', 'KA9271215168123'),
	('TN16ZX3533', 'KA0116153338456'),
	('TN02GJ8084', 'KA7100176472789'),
	('TN05SL2861', 'KA1650322703123'),
	('TN09DJ1847', 'KA8559318708456'),
	('KL05JW1823', 'KA3490450786789'),
	('KL13GC1750', 'KA4900720050123'),
	('KL04NW8748', 'KA5181015879456'),
	('KL02WT2513', 'KA1635441300789'),
	('KL06NW7263', 'KA9714832437123'),
	('KL09BF8806', 'KA1222009621456'),
	('KL04VZ2216', 'AP2380219472789'),
	('KL03IR5998', 'AP5698741236123'),
	('KL06LZ1741', 'AP7568974526456'),
	('KL09WX1877', 'AP2569874123300'),
	('KL03CX7308', 'KA5915915780789'),
	('KL05NC4741', 'KA0116153338456');
-- SELECT *  FROM `VehicleOwnership`;

-- Regestering a Driver
INSERT INTO `DriverDetails` VALUES	
	('KA4437564037123', 'KARAN', '9272551692'),
	('KA2302656106456', 'ARYAN', '8658137551'),
	('KA5915915780789', 'NITISH', '9757826908'),
	('KA9271215168123', 'YAGNESH', '9175018249'),
	('KA0116153338456', 'HARSH', '9018585459'),
	('KA7100176472789', 'PRAJEETH', '8068041901'),
	('KA1650322703123', 'MEGHANATH', '8791914728'),
	('KA8559318708456', 'BADRINATH', '9362113557'),
	('KA3490450786789', 'MOUNIKA', '9362199734'),
	('KA4900720050123', 'JAYANTH', '9893525968'),
	('KA5181015879456', 'SAI NIVAS', '9737787196'), 
	('KA1635441300789', 'VIJAY', '9239396632'),
	('KA9714832437123', 'RAM', '9769508876'),
	('KA1222009621456', 'VIVEK', '8910757191'),
	('AP2380219472789', 'ADITYA', '9835502411'),
	('AP5698741236123', 'PRANAY', '9415531413'),
	('AP7568974526456', 'THANMAI', '9091937206'),
	('AP2569874123300', 'NAMAN', '9185355193'),
	('AP1290050000198', 'MANIKANTA', '9867453210'),
	('KA1220098600788', 'ANIKETH', '9078563412'),
	('KA1220050456732', 'DEEPAK', '8976543201'),
	('AP2120045600188', 'MOKSHITH', '9390034366'),
	('TS2740844110735', 'VISHWA', '6598743214'),
	('TS4856336096059', 'VINAY', '7598743214'),
	('TS7398170770922', 'RANJITH', '7598743214'),
	('TS4776625277229', 'MANI', '7598743214');
-- SELECT *  FROM `DriverDetails`;


INSERT INTO `SlotAllotment` VALUES 
	('KL05NC4741', '2021-05-24 08:41:49', '2021-05-24 08:42:00', 0, 0.55, 1, 'AP2120045600188', 0),
	('KL09WX1877', '2021-05-24 08:41:49', '2021-05-24 08:42:00', 0, 0.55, 2, 'KA4437564037123', 0),
	('KL03CX7308', '2021-05-24 08:43:49', '2021-05-24 08:44:00', 0, 0.55, 3, 'KA2302656106456', 0),
	('KL06LZ1741', '2021-05-24 08:45:49', '2021-05-24 08:46:00', 0, 0.55, 4, 'KA5915915780789', 0),
	('KL09BF8806', '2021-05-24 09:41:00', '2021-05-24 09:42:00', 0, 3.00, 5, 'KA0116153338456', 0),
	('TN13TJ3407', '2021-05-24 09:41:00', '2021-05-24 09:42:00', 0, 3.00, 6, 'KA5915915780789', 0),
	('KA01SH5904', '2021-05-24 10:41:49', '2021-05-24 10:42:00', 0, 0.275, 16, 'KA4900720050123', 0),
	('AP06UJ8051', '2021-05-24 10:41:49', '2021-05-24 10:42:00', 0, 0.275, 17, 'KA5181015879456', 0),
	('KA14VQ3431', '2021-05-24 10:42:00', '2021-05-24 10:43:00', 0, 1.50, 16, 'AP5698741236123', 0),
	('KA01SH5904', '2021-05-24 10:42:00', '2021-05-24 10:43:00', 0, 1.50, 17, 'AP7568974526456', 0),
	('TN17WL0579', '2021-05-24 11:41:00', '2021-05-24 11:46:00', 0, 15.00, 1, 'KA0116153338456', 0),
	('TN18UW0259', '2021-05-24 11:41:00', '2021-05-24 11:46:00', 0, 15.00, 2, 'KA8559318708456', 0),
	('TN04YO3554', '2021-05-25 08:41:49', '2021-05-25 08:42:00', 0, 0.55, 1, 'KA1220098600788', 0),
	('TN16ZX3533', '2021-05-25 08:41:49', '2021-05-25 08:42:00', 0, 0.55, 2, 'KA1220050456732', 0),
	('TN02GJ8084', '2021-05-25 08:41:49', '2021-05-25 08:42:00', 0, 0.55, 3, 'AP2120045600188', 0),
	('TN05SL2861', '2021-05-25 08:41:49', '2021-05-25 08:42:00', 0, 0.55, 4, 'TS4856336096059', 0),
	('TN09DJ1847', '2021-05-25 08:41:49', '2021-05-25 11:41:49', 0, 540, 5, 'TS7398170770922', 1),
	('KL05JW1823', '2021-05-25 08:41:49', '2021-05-25 11:41:48', 0, 539.95, 6, 'TS4776625277229', 0),
	('TN09GU5456', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 16, 'KA3490450786789', 0),
	('TN09DG4165', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 17, 'KA4900720050123', 0),
	('TN10IU4576', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 18, 'KA5181015879456', 0),
	('AP20CF2356', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 19, 'AP1290050000198', 0),
	('AP06UJ8051', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 20, 'AP2569874123300', 0),
	('KA14VQ3431', '2021-05-26 11:41:00', '2021-05-26 11:46:00', 0, 7.50, 21, 'KA1220050456732', 0),
	('TN05SL2861', '2021-05-26 17:41:49', '2021-05-26 17:42:00', 0, 0.55, 1, 'KA1635441300789', 0),
	('KL04NW8748', '2021-05-26 17:41:49', '2021-05-26 17:42:00', 0, 0.55, 2, 'KA9714832437123', 0),
	('KL09BF8806', '2021-05-26 17:41:49', '2021-05-26 17:42:00', 0, 0.55, 3, 'KA1222009621456', 0),
	('KL04VZ2216', '2021-05-26 17:41:49', '2021-05-26 20:41:48', 0, 539.95, 4, 'AP2380219472789', 0),
	('KL03IR5998', '2021-06-18 19:41:49', '2021-06-18 19:42:00', 0, 0.55, 5, 'AP5698741236123', 0),
	('KL05NC4741', '2021-06-18 19:41:49', '2021-06-18 19:42:00', 0, 0.55, 6, 'AP7568974526456', 0);
-- SELECT * FROM `SlotAllotment`;



-- Allotment of slot
DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.AllotSlot(
	IN vehicle VARCHAR(10),
    IN slot INT,
    IN driver VARCHAR(15)
)
	LANGUAGE SQL
    MODIFIES SQL DATA
    BEGIN
		INSERT INTO SlotAllotment(`VehicleNumber`, `Slot`, `DLNumber`) VALUES 
			(vehicle, slot, driver);
	END
    //
DELIMITER ;

-- UPDATE Slot SET `Occupancy` = 'Y' WHERE `Slot` = 4;
-- CALL AllotSlot('TN24IF1089', 4, 'AP2120045600188');



-- Completion of using slot
DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.charge(
	IN vehicle VARCHAR(10)
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SET @typeof = (SELECT `Type` FROM VehicleDetails Where `VehicleNumber` = vehicle);
		SET @price = (SELECT `Charge` FROM Charge WHERE `Type` = @typeof);
		
		UPDATE SlotAllotment SET `OutTime` = CURRENT_TIMESTAMP() WHERE `VehicleNumber` = vehicle AND `State` = TRUE;

		SET @inTime =(SELECT `InTime` FROM `SlotAllotment` WHERE `VehicleNumber` = vehicle AND `State` = TRUE);
		SET @outTime =(SELECT `OutTime` FROM `SlotAllotment` WHERE `VehicleNumber` = vehicle AND `State` = TRUE);
		SET @elapse = TIMESTAMPDIFF(SECOND,@inTime, @outTime);
		UPDATE SlotAllotment SET Charge = @elapse *  @price WHERE `VehicleNumber` = vehicle and `State` = TRUE;
	END
    //
DELIMITER ;
-- UPDATE Slot SET `Occupancy` = 'N' WHERE `Slot` = 4;
-- CALL charge('TN24IF1089');
-- UPDATE SlotAllotment SET `State` = FALSE WHERE `VehicleNumber` = vehicle AND `State` = TRUE;

-- SELECT * FROM `SlotAllotment`;
-- SELECT * FROM `Slot`;

-- Change of Vehicle Ownership
DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.RegisterVehicle(
	IN vehiclenumber VARCHAR(10),
    IN idnumber VARCHAR(45)
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		INSERT INTO `VehicleOwnership` VALUES (vehiclenumber, idnumber);
	END
    //
DELIMITER ;


DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.DailyReport()
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SET @RangeFrom = current_date();
		SET @RangeTill = DATE_ADD(current_date, INTERVAL 1 DAY);
		SELECT VehicleNumber, InTime, OutTime, Slot, Charge
		FROM SlotAllotment
		WHERE InTime BETWEEN @RangeFrom AND @RangeTill;
	END
    //
DELIMITER ;
-- CALL DailyReport();


DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.RangeReport(
	IN datein TIMESTAMP,
    IN dateout TIMESTAMP
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SET @RangeFrom = datein;
		SET @RangeTill = DATE_ADD(dateout, INTERVAL 1 DAY);
		SELECT VehicleNumber, InTime, OutTime, Slot, Charge
		FROM SlotAllotment
		WHERE InTime BETWEEN @RangeFrom AND @RangeTill;
	END
    //
DELIMITER ;
-- CALL RangeReport('2021-05-24','2021-05-27');

-- Number of Vehicles in that particular Slot at a date
DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.SlotCount(
	IN datein TIMESTAMP,
    IN dateout TIMESTAMP,
    IN slots INT
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SET @RangeFrom = datein;
		SET @RangeTill = DATE_ADD(dateout, INTERVAL 1 DAY);
		SELECT COUNT(*) 
        FROM SlotAllotment 
        WHERE InTime  Between @RangeFrom AND @RangeTill
					and Slot = slots;
	END
    //
DELIMITER ;
-- CALL SlotCount('2021-06-18', '2021-06-18', 5);


-- Type of vehicles in a date
DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.TypeCount()
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SET @RangeFrom = current_date();
		SET @RangeTill = DATE_ADD(current_date, INTERVAL 1 DAY);
		SELECT `Type`, COUNT(*) 
		FROM 
			(SELECT *
			FROM VehicleDetails as vd  
			NATURAL JOIN SlotAllotment as SA) as count
		Where InTime  Between @RangeFrom AND @RangeTill
		Group by `Type`;
	END
    //
DELIMITER ;
-- Call TypeCount();

-- Owners and Drivers of a Particular vehicle.

DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.DateChange(
	IN datein varchar(15)
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		SELECT DATE_FORMAT(STR_TO_DATE(datein, '%d-%m-%y'), '%Y-%m-%d');
	END
    //
DELIMITER ;
-- CALL DateChange(29-05-2021);

-- Owner Details

DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.OwnerDetails(
	IN Vehicle varchar(10)
)
	LANGUAGE SQL
    MODIFIES SQL DATA
	BEGIN
		Select *
		From OwnerDetails 
		Where IDNumber = (SELECT IDNumber 
							FROM VehicleOwnership 
							WHERE VehicleNumber = Vehicle);
	END
    //
DELIMITER ;
-- CALL OwnerDetails('AP06UJ8051');

DELIMITER //
CREATE PROCEDURE VehicleParkingManagementSystem.DriverDetails(
	IN Vehicle varchar(10)
)
LANGUAGE SQL
MODIFIES SQL DATA
BEGIN
	SELECT `DLNumber`, `Name`, `MobileNumber`
    FROM (SELECT *
			FROM SlotAllotment as SA
            NATURAL JOIN DriverDetails as DD) as DRI
	WHERE VehicleNumber = Vehicle;
END
//
DELIMITER ;
-- CALL DriverDetails('KL09BF8806');
